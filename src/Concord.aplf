   Concord file

    ; Dict; Highlight; LineFmt; LNumFmt; Skip; WordList; WordFmt
    ; CHAR_STD; CHAR_BOLD; WORD_LEN; LINE_LEN; LNUM_LEN; MAX_WIDTH
    ; len; line; lines; lNum; lNums; lNumField; match; offset; rec; recs; word; wordRaw
    ; wCurL; w2Line; wFreq 
    ; â•IO; â•PW

  â Demo text...
    {}â•SE.UCMD 'load Dict.aplf'
    :IF 0=â‰¢file 
       :IF 0=â•NC '#.SHAKESPEARE'
           {
            #.SHAKESPEAREâ† (â•UCS 10)(â‰ âŠ†âŠ¢) 5000â†‘13006â†“â•OR _â†â•SE.UCMD 'get ',âµ
            â•â†'Loaded #.SHAKESPEARE'
            1: _â†â•EX _
           }'https://ocw.mit.edu/ans7870/6/6.006/s08/lecturenotes/files/t8.shakespeare.txt'
       :ENDIF
       fileâ† #.SHAKESPEARE
    :ENDIF 

    â•IOâ†0
    â•PWâ† MAX_WIDTHâ† 120

    LNUM_LEN â† 4  
    LNumFmtâ† (â•LNUM_LEN)âˆ˜{,âµ â•FMTâ¨ 'ZI',âº}

    WordListâ†{
        '([:â•]?[\w_âˆ†â™]+(?:''[st])?)' â•S 0 1âŠ£âµ
    }
    
    Highlightâ†{ 
      line wordRawâ†âº âµ
      Replâ†{ wâ†âµ â‹„ Bâ†âµâˆŠCHAR_STD â‹„ (B/w)â†CHAR_BOLD[CHAR_STDâ³B/w] â‹„ w}
      ('(?<![â•:])\b',wordRaw,'\b') â•R {Repl âµ.Lengths[0]â†‘âµ.Offsets[0]â†“âµ.Block}   â 1 âŠ£ line
    }
       CHAR_STDâ†     â•A,â•Câ•A 
       CHAR_BOLDâ†    â•UCS (â•UCS 'ğ€')+â³52

    Skipâ† âˆŠâˆ˜(â•D,'â•:') 

    wFreqâ†   0 Dict â¬         â Word frequencies
    w2Lineâ†  â¬ Dict â¬         â Word to lNum and lines
    
    lNumâ†0 
    â•â† 'Source text' 
    LINE_LENâ† MAX_WIDTH - LNUM_LEN + 3
    :FOR line :IN file
         lNum+â†1 â‹„ thisLineâ† 0 Dict â¬
         wCurLâ†â¬

         â•â† (LNumFmt lNum), ' | ',(LINE_LENâ†‘ line)
         
        :For offset len :IN  WordList line
            wordRawâ†lenâ†‘ offsetâ†“ line
            wordâ† â•C wordRaw 
            :IF Skip âŠƒwordRaw â‹„ :Continue â‹„ :ENDIF 
            wCurL,â† âŠ‚word wordRaw 
            word +wFreq.Do 1
        :EndFor
      â For each line, highlight all appearances of the word at the same time.
        :For word wordRaw :IN wCurL/â¨ â‰ âŠƒÂ¨wCurL     â Suppress repeats...
            word w2Line.Cat lNum (line Highlight wordRaw)
        :EndFor 
    :ENDFOR 
    â•â†''

    WORD_LENâ† âŒˆ/â‰¢Â¨wFreq.Keys
    LINE_LENâ† MAX_WIDTH- (LNUM_LEN + WORD_LEN + 2Ã—3)   â 3 per ' | '
    
    WordFmtâ† WORD_LENâˆ˜â†‘
    LineFmtâ† LINE_LENâˆ˜â†‘

    w2Line.    (SortBy  Keys)

    â•â†'Word Frequencies and Lines'
    :FOR word recs :IN w2Line.Items
         lNumsâ† âˆªâŠƒÂ¨recs 
         â•â† (WordFmt word), ' ', ('[',']',â¨â•wFreq.Get word),' ', 2â†“âˆŠ(âŠ‚', '),âˆ˜ â• Â¨lNums 
    :ENDFOR    
    â•â†''

    â•â†'Concordance'
    :FOR word recs :IN  w2Line.Items
         :FOR lNum line :IN recs
            â•â† (LNumFmt lNum), ' | ', (WordFmt word), ' | ', (LineFmt line)
         :ENDFOR 
    :ENDFOR

