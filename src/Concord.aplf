   Concord text

    ; â•IO; â•PW
    ; âˆ†DICT; Highlight; LineFmt; LNumFmt; Skip; Trim; WordList; WordFmt
    ; CHAR_STD; CHAR_BOLD; WORD_LEN; LINE_LEN; LNUM_LEN; MAX_WIDTH
    ; len; line; lines; lNum; lNums; lNumField; match; offset; rec; recs; word; wordRaw
    ; wCurL; w2Line; wFreq 

    {}â•SE.UCMD 'load  âˆ†DICT'

  â Demo text...
    textâ† text {
        0â‰ â‰¢âº: âº
        0â‰ â•NC '#.SHAKESPEARE': #.SHAKESPEARE 
        0:: 911 â•SIGNALâ¨'Something bad happened' 
            #.SHAKESPEAREâ† (â•UCS 10)(â‰ âŠ†âŠ¢) 5000â†‘13006â†“â•OR _â†â•SE.UCMD 'get ',âµ
            â•â†'Loaded #.SHAKESPEARE'
            #.SHAKESPEARE
    }'https://ocw.mit.edu/ans7870/6/6.006/s08/lecturenotes/files/t8.shakespeare.txt' 

    â•IOâ†0
    â•PWâ† MAX_WIDTHâ† 120

    LNUM_LEN â† 4  
    LNumFmtâ† (â•LNUM_LEN)âˆ˜{,âµ â•FMTâ¨ 'ZI',âº}

    Trimâ† {âµâ†“â¨+/âˆ§\' '=âµ}
    
    WordListâ†{
        '([:â•]?[\w_âˆ†â™]+(?:''[\w_âˆ†â™]+)?)' â•S 0 1âŠ£âµ
    }
    
    Highlightâ†{ 
      line wordRawâ†âº âµ
      Replâ†{ wâ†âµ â‹„ Bâ†âµâˆŠCHAR_STD â‹„ (B/w)â†CHAR_BOLD[CHAR_STDâ³B/w] â‹„ w}
      ('(?<![â•:])\b',wordRaw,'\b') â•R {Repl âµ.Lengths[0]â†‘âµ.Offsets[0]â†“âµ.Block}   â 1 âŠ£ Trim line
    }
       CHAR_STDâ†     â•A,â•Câ•A 
       CHAR_BOLDâ†    â•UCS (â•UCS 'ğ€')+â³52

    Skipâ† âˆŠâˆ˜(â•D,'â•:')âŠƒ 

    wFreqâ†   0 âˆ†DICT â¬         â Word frequencies
    w2Lineâ†  â¬ âˆ†DICT â¬         â Word to lNum and lines
    
    lNumâ†0 
    â•â† 'Source text' 
    LINE_LENâ† MAX_WIDTH - LNUM_LEN + 3
    :FOR line :IN text
         lNum+â†1  

         â•â† (LNumFmt lNum), ' | ',(LINE_LENâ†‘ line)
         
        wCurLâ†â¬
        :For offset len :IN  WordList line
            wordRawâ†lenâ†‘ offsetâ†“ line
            wordâ† â•C wordRaw 
            :IF Skip word â‹„ :Continue â‹„ :ENDIF 
            wCurL,â† âŠ‚word wordRaw 
            word +wFreq.Do1 1
        :EndFor
      â For each word in this line, highlight all appearances of that word simultaneously.
      â To do that, we process repeat appearances (ignoring case) with the first.
        :For word wordRaw :IN wCurL/â¨ â‰ âŠƒÂ¨wCurL      
            word w2Line.Cat1 lNum (line Highlight wordRaw)
        :EndFor 
    :ENDFOR 
    â•â†''

    WORD_LENâ† âŒˆ/â‰¢Â¨wFreq.Keys
    LINE_LENâ† MAX_WIDTH- (LNUM_LEN + WORD_LEN + 2Ã—3)   â 3 per ' | '
    
    WordFmtâ† WORD_LENâˆ˜â†‘
    LineFmtâ† LINE_LENâˆ˜â†‘

    â•â†'Word Frequencies and Lines'
    w2Line.(SortBy Keys)
    :FOR word recs :IN w2Line.Items
         lNumsâ† âˆªâŠƒÂ¨recs 
         â•â† (WordFmt word), ' ', ('[',']',â¨â•wFreq.Get1 word),' ', 2â†“âˆŠ(âŠ‚', '),âˆ˜ â• Â¨lNums 
    :ENDFOR    
    â•â†''

    â•â†'Concordance'
    :FOR word recs :IN  w2Line.Items
         :FOR lNum line :IN recs
            â•â† (LNumFmt lNum), ' | ', (WordFmt word), ' | ', (LineFmt line)
         :ENDFOR 
    :ENDFOR

