:Namespace Markdown
ââââ Use Markdown in an HTMLRenderer session in Dyalog
ââââ Usage:
ââââ   [htmlâ†]  [size] Markdown.Show markdown
ââââ where Â¨markdownÂ¨ is a vector of character vectors containing standard "Showdown-style" Markdown.
ââââ and Â¨sizeÂ¨ is an optional size in pixels of the resulting page (default: 800 1000).
ââââ Â¨ShowÂ¨ returns the resulting HTML as a vector of character vectors.
ââââ 
ââââ There are a couple of useful utilities, such as Â¨HereÂ¨ and Â¨FlatÂ¨.
ââââ Â¨HereÂ¨ makes it easy to take comments in APL functions and return them as Markdown or HTML code.
ââââ Â¨FlatÂ¨ convers a vector of character vectors to a flat char vector with carriage returns. 
ââââ
ââââ   Markdown.example
ââââ contains a nice example. To see the result, do:
ââââ   xâ† Markdown.(Show example)
ââââ Deleting Â¨xÂ¨ (or resetting its value) will remove the displayed markdown html.
ââââ 
  â Here: CVVâ† token@CV âˆ‡ CVV                    
  â   Find payload in char vectors (CV) matching ('^\h*â',token) in a vector of CV's. 
  â   If the token is XX, we match /^\h*âMX/ followed by /\h|$/. 
  â   What follows /.*$/ is the payload. 
  Hereâ† { 
    reâ†'^\h*â', âº, '(?:\h|$)(.*)'                        
    re â•S '\1'âŠ£ âµ 
  }
  â MD:   CVVâ† CVV âˆ‡ CVV                             
  â   Insert âº:markdown into âµ:html at ___MYTEXT___
  MDâ† { 
      _Onceâ† â ('ML' 1) 
      Esc_â† '\\' â•R '\\\\'      
      from toâ† '^\h*___MYTEXT___.*$' (Flat Esc_ âº)
      from  â•R to _OnceâŠ£ âµ 
  }
  â Flat:  CcrVâ† âˆ‡ CVV                               
  â   Convert vector of char vectors into a CV with carriage returns.
  Flatâ† {Â¯1â†“ âˆŠâµ,Â¨ â•UCS 13}âŠ†
:Namespace Html 
  â Html.Render: Ã˜â† size@I[2] âˆ‡ html@CVV
  â   Returns an html renderer object generated by â•WC.
  Renderâ† {  
    parmsâ† ('HTML',â¥âŠ‚ ##.Flat âµ) (âº,â¨ âŠ‚'Size') ('Coord' 'ScaledPixel') 
    nsâ† #.â•NSâ¬                                    â Private ns for generated obj 
    ns.oâŠ£ 'ns.o' â•WC 'HTMLRenderer',â¥âŠ† parms      â Return the generated object itself.
  } 
:EndNamespace 

exampleâ† 'M' Here â•SRC â•THIS                       â a markdown example.  

Showâ†{
â hNs@CVVâ† size@IV=(800 1000) âˆ‡ markdown@CVV
â markdown: APL char vectors (CVV)  
â size:     Html window size (default: 800 1000)  
â hNs:      Dyalog Render object (â•WC namespace)
â           hNs.HTML contains the generated HTML as a character vector with CR's. 
â Once the result returned disappears, the generated HTML object disappears also.
â Do:          hâ† size Markdown.Show ... 
â Then later:  â•EX 'h' OR hâ†''
  âºâ† 800 1000 â‹„ size markdownâ†âº âµ 
  htmlâ† markdown MD 'H' Here â•SRC â•THIS           â Insert the markdown text into the HTML/JS code   
  size Html.Render html                           â Render and return the HTML object
}

â -------------------------------------------------------------------------------------------
â  example: Markdown example source 
âM # An example of *Markdown* in the ***Showdown*** dialect
âM
âM ## A Paragraph
âM This is a paragraph with **bold** text and this Emoji smile :smile: is generated via 
âM the expression :smile\:.  We have set **simpleLineBreaks: false**, so a single paragraph 
âM can be generated from multiple contiguous lines.
âM We have four such lines here making one paragraph. This face ğŸ˜œ is represented _directly_ in APL. 
âM
âM 1. This is a bullet
âM      * This is a *sub-*bullet.
âM           * A sub***ber*** bullet.
âM           * And another!
âM 1. This is another top-level bullet. 
âM 1. As is this.
âM      We allow simplified autolinks to places like http://www.dyalog.com.
âM
âM     > A blockquote would look great here...
âM
âM 1. A final bullet?
âM 
âM ### Tonnage of [Columbus' Ships](http://columbuslandfall.com/ccnav/ships.shtml)\. 
âM 
âM   | Ship  | NiÃ±a    | Pinta | Santa Maria |
âM   |: ---- |: ----- :|:-----:|:-----:|
âM   | Type | caravel | caravel | carrack |
âM   | Tonnage | 50-60 tons   | 70 tons  | 100 tons |
âM   | Perceived size | ~~big~~| ~~bigger~~ | ~~gigantic~~ |
âM   | Actual size| shrimpy shrimp | small shrimp | jumbo shrimp |
âM
âM This is code: `â³2` 
âM 
âM This is *also* code: <code>â³3</code> 
âM 
âM And so is this:
âM 
âM      â Set off with 6 blanks
âM        âˆ‡ Pâ† A IOTA B
âM          Pâ† A â³ B
âM        âˆ‡
âM
âM This should work. Does it? (**Yes**)
âM ```
âM +/âºâ³âµ
âM -\âµâ³âº
âM ```
âM
âM ### What about tasks?
âM + [x] This task is done
âM - [ ] This is still pending
âM + [x] We knocked this out of the park!
âM 
âM ### Goodbye:exclamation::exclamation::exclamation:
âM 

â -------------------------------------------------------------------------------------------
â  Markdown-to-Html code-- "showdown" javascript
âH <!DOCTYPE html>
âH <html>
âH <head>
âH   <title>Showdown Example</title>
âH   <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js" 
âH        integrity="sha512-LhccdVNGe2QMEfI3x4DVV3ckMRe36TfydKss6mJpdHjNFiV07dFpS2xzeZedptKZrwxfICJpez09iNioiSZ3hA==" 
âH        crossorigin="anonymous" referrerpolicy="no-referrer">
âH   </script>
âH </head>
âH <body>
âH   <div id="markdown-content" style="display:none;">
âH     ___MYTEXT___          // User Markdown will replace this entire line!
âH   </div>
âH   <div id="html-content"></div>
âH   <script>
âH     var markdownText = document.getElementById('markdown-content').textContent;
âH     const converter = new showdown.Converter({
âH      // For all options except ghCodeBlocks, the DEFAULT value is false
âH      // Simple line break: If true, simple line break in paragraph emits <br>.
âH      //                    If false (default), simple line break does not emit <br>.
âH         simpleLineBreaks: false, 
âH      // Enable tables 
âH         tables: true,
âH      // Enable strikethrough 
âH         strikethrough: true,
âH      // Omit extra line break in code blocks
âH         omitExtraWLInCodeBlocks: true,
âH      // Enable GitHub-compatible header IDs
âH         ghCompatibleHeaderId: true,
âH      // Fenced code blocks. True (default), enable code blocks with ``` ... ``` 
âH         ghCodeBlocks: true,
âH      // Prefix header IDs with "custom-id-"
âH         prefixHeaderId: 'custom-id-',
âH      // Enable emoji support 
âH         emoji: true,
âH      // Enable task lists 
âH         tasklists: true,
âH      // Disable automatic wrapping of HTML blocks
âH         noHTMLBlocks: false,
âH      // Allow simple URLs like http://dyalog.com in text to be treated as actual links. 
âH      // Keep in mind that selecting a link will leave the Markdown page, w/o an easy way  
âH      // to return (except by recreating the page).
âH         simplifiedAutoLink: true,           
âH     });
âH     const html = converter.makeHtml(markdownText);
âH     document.getElementById('html-content').innerHTML = html;
âH   </script>
âH </body>
âH </html>
:EndNamespace 
